<br /><br />

<mat-dialog-content class="cd-content">
  <div class="row topo">
    <div class="col-2">
      <img
        src="https://www.gov.br/incra/pt-br/canais_atendimento/LogoINCRAverticaldegrad.png"
        class="logo"
      />
    </div>
    <div class="col-10 texto">
      <strong>
        <h5>INCRA - Instituto Nacional de Colonização e Reforma Agrária</h5>
      </strong>
      <br />
      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
      tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
      veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
      commodo consequat.
    </div>
  </div>

  <!-- Cabeçalho com identificação do beneficiário (mantido) -->
  <div class="header-dados">
    <div><strong>DEVEDOR:</strong> {{ beneficiarioNome || "xxxxx" }}</div>
    <div><strong>CPF:</strong> {{ beneficiarioCpf || "xxxxx" }}</div>
  </div>

  <!-- Se não houver débitos -->
  <div class="table-container" *ngIf="debitos?.length; else vazio">
    <ng-container *ngFor="let d of debitos; let i = index">
      <!-- BLOCO 6 – IDENTIFICAÇÃO DA RECEITA -->
      <h3 class="bloco-titulo">Identificação da Receita</h3>
      <table class="pagamentos-table" role="table">
        <thead>
          <tr>
            <th>Tipo da Receita</th>
            <th>Descrição da Receita</th>
            <th>Valor Original</th>
            <th>Nº Prestações</th>
            <th>Saldo Devedor</th>
            <th>Objeto do Crédito</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input type="text" [value]="d.tipoReceita || 'xxxxx'" disabled />
            </td>
            <td>
              <input
                type="text"
                [value]="d.descricaoReceita || 'xxxxx'"
                disabled
              />
            </td>
            <td>
              <input
                type="text"
                [value]="formataNumero(d.valorOriginal) || 'xxxxx'"
                disabled
                style="text-align: right"
              />
            </td>
            <td>
              <input
                type="text"
                [value]="d.numeroPrestacoes ?? 'xxxxx'"
                disabled
                style="text-align: right"
              />
            </td>
            <td>
              <input
                type="text"
                [value]="formataNumero(d.saldoDevedor) || 'xxxxx'"
                disabled
                style="text-align: right"
              />
            </td>
            <td>
              <input
                type="text"
                [value]="d.objetoCredito || 'xxxxx'"
                disabled
              />
            </td>
          </tr>
        </tbody>
      </table>

      <!-- BLOCO 3 – PLANO DE PAGAMENTO -->
      <h3 class="bloco-titulo">Plano de pagamento</h3>
      <table class="pagamentos-table" role="table">
        <thead>
          <tr>
            <th>Tipo da Receita</th>
            <th>Valor Concedido</th>
            <th>Prazos / Condições</th>
            <th>Regras Legais</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input type="text" [value]="d.tipoReceita || 'xxxxx'" disabled />
            </td>
            <td>
              <input
                type="text"
                [value]="formataNumero(d.valorConcedido) || 'xxxxx'"
                disabled
                style="text-align: right"
              />
            </td>
            <td>
              <input
                type="text"
                [value]="d.prazosCondicoesReembolso || 'xxxxx'"
                disabled
              />
            </td>
            <td>
              <input
                type="text"
                [value]="d.regrasLegaisPrograma || 'xxxxx'"
                disabled
              />
            </td>
          </tr>
        </tbody>
      </table>

      <!-- BLOCO 4 – DOCUMENTO DE TITULAÇÃO -->
      <table class="pagamentos-table" role="table">
        <thead>
          <tr>
            <th>Título de Domínio</th>
            <th>Contrato</th>
            <th>Termo Aditivo</th>
            <th>Outros Documentos</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input
                type="text"
                [value]="d.tituloDominio || 'xxxxx'"
                disabled
              />
            </td>
            <td>
              <input type="text" [value]="d.contrato || 'xxxxx'" disabled />
            </td>
            <td>
              <input type="text" [value]="d.termoAditivo || 'xxxxx'" disabled />
            </td>
            <td>
              <ng-container *ngIf="d.outrosDocumentos?.length; else semDocs">
                <div
                  *ngFor="let od of d.outrosDocumentos"
                  style="margin-bottom: 4px"
                >
                  <input type="text" [value]="od" disabled />
                </div>
              </ng-container>
              <ng-template #semDocs>
                <input type="text" value="xxxxx" disabled />
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- BLOCO 5 – RECEITAS DIVERSAS -->
      <table class="pagamentos-table" role="table">
        <thead>
          <tr>
            <th>Descrição do Objeto</th>
            <th>Condições de Cobrança</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input
                type="text"
                [value]="d.descricaoObjeto || 'xxxxx'"
                disabled
              />
            </td>
            <td>
              <input
                type="text"
                [value]="d.condicoesCobranca || 'xxxxx'"
                disabled
              />
            </td>
          </tr>
        </tbody>
      </table>

      <div style="height: 1rem"></div>
      <hr />
      <div style="height: 1rem"></div>
    </ng-container>
  </div>

  <!-- GRID DE PARCELAS / LANÇAMENTOS -->
  <h3 class="bloco-titulo">Parcelas / Lançamentos</h3>

  <div class="table-container mat-elevation-z1">
    <table
      mat-table
      [dataSource]="pagamentos"
      class="pagamentos-table"
      role="table"
    >
      <!-- COLUNA SELEÇÃO (TOTAL / PARCIAL) -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="masterToggle()"
            [checked]="isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="selection.toggle(row)"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Nº REF -->
      <ng-container matColumnDef="numeroReferencia">
        <th mat-header-cell *matHeaderCellDef>Nº Ref.</th>
        <td mat-cell *matCellDef="let p">{{ p.numeroReferencia || "—" }}</td>
      </ng-container>

      <!-- NOSSO NÚMERO -->
      <ng-container matColumnDef="nossoNumero">
        <th mat-header-cell *matHeaderCellDef>Nosso Número</th>
        <td mat-cell *matCellDef="let p">{{ p.nossoNumero || "—" }}</td>
      </ng-container>

      <!-- PRESTAÇÃO -->
      <ng-container matColumnDef="parcela">
        <th mat-header-cell *matHeaderCellDef>Prest.</th>
        <td mat-cell *matCellDef="let p">{{ p.parcela || "—" }}</td>
      </ng-container>

      <!-- VENCIMENTO -->
      <ng-container matColumnDef="dataVencimento">
        <th mat-header-cell *matHeaderCellDef>Vencimento</th>
        <td mat-cell *matCellDef="let p">{{ p.dataVencimento || "—" }}</td>
      </ng-container>

      <!-- PRORROGAÇÃO -->
      <ng-container matColumnDef="prorrogacao">
        <th mat-header-cell *matHeaderCellDef>Prorrogação</th>
        <td mat-cell *matCellDef="let p">{{ p.prorrogacao || "—" }}</td>
      </ng-container>

      <!-- MOEDA -->
      <ng-container matColumnDef="moeda">
        <th mat-header-cell *matHeaderCellDef>Moeda</th>
        <td mat-cell *matCellDef="let p">R$</td>
      </ng-container>

      <!-- VALOR -->
      <ng-container matColumnDef="valorOriginal">
        <th mat-header-cell *matHeaderCellDef>Valor</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.valorOriginal) }}
        </td>
      </ng-container>

      <!-- CORREÇÃO -->
      <ng-container matColumnDef="correcao">
        <th mat-header-cell *matHeaderCellDef>Correção</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.correcao) }}
        </td>
      </ng-container>

      <!-- JUROS -->
      <ng-container matColumnDef="juros">
        <th mat-header-cell *matHeaderCellDef>Juros</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.jurosMora) }}
        </td>
      </ng-container>

      <!-- JUROS MORA -->
      <ng-container matColumnDef="jurosMora">
        <th mat-header-cell *matHeaderCellDef>Juros Mora</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.jurosMora) }}
        </td>
      </ng-container>

      <!-- MULTA -->
      <ng-container matColumnDef="multa">
        <th mat-header-cell *matHeaderCellDef>Multa</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.multa) }}
        </td>
      </ng-container>

      <!-- DESCONTOS -->
      <ng-container matColumnDef="desconto">
        <th mat-header-cell *matHeaderCellDef>Descontos</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.desconto) }}
        </td>
      </ng-container>

      <!-- DESCONTO EXCEDENTE -->
      <ng-container matColumnDef="remissao">
        <th mat-header-cell *matHeaderCellDef>Desc. Exced.</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.remissao) }}
        </td>
      </ng-container>

      <!-- CRÉDITO -->
      <ng-container matColumnDef="credito">
        <th mat-header-cell *matHeaderCellDef>Crédito</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.credito) }}
        </td>
      </ng-container>

      <!-- A PAGAR -->
      <ng-container matColumnDef="valorDevido">
        <th mat-header-cell *matHeaderCellDef>A pagar</th>
        <td mat-cell *matCellDef="let p" style="text-align: right">
          {{ formataNumero(p.valorDevido) }}
        </td>
      </ng-container>

      <!-- MOEDA (FINAL) -->
      <ng-container matColumnDef="moedaFinal">
        <th mat-header-cell *matHeaderCellDef>Moeda</th>
        <td mat-cell *matCellDef="let p">R$</td>
      </ng-container>

      <!-- BAIXADO -->
      <ng-container matColumnDef="baixado">
        <th mat-header-cell *matHeaderCellDef>Baixado</th>
        <td mat-cell *matCellDef="let p">
          {{ p.dataPagamento ? "Sim" : "Não" }}
        </td>
      </ng-container>

      <!-- Nº AVISO BAIXA -->
      <ng-container matColumnDef="numeroAvisoBaixa">
        <th mat-header-cell *matHeaderCellDef>Nº Aviso Baixa</th>
        <td mat-cell *matCellDef="let p">{{ p.numeroAvisoBaixa || "—" }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        (click)="selection.toggle(row)"
      ></tr>
    </table>
  </div>

  <ng-template #vazio>
    <p>Nenhum débito encontrado.</p>
  </ng-template>

  <ng-template #vazio>
    <div class="vazio">Nenhum registro de débito encontrado.</div>
  </ng-template>
</mat-dialog-content>

<div class="acoes">
  <button
    mat-flat-button
    color="primary"
    (click)="imprimir()"
    class="btn-imprimir"
  >
    <mat-icon>print</mat-icon>
    Imprimir
  </button>

  <button
    mat-flat-button
    color="accent"
    (click)="baixarGRU()"
    class="btn-baixar"
  >
    <mat-icon>download</mat-icon>
    Baixar GRU
  </button>

  <mat-dialog-actions align="end">
    <button mat-stroked-button (click)="fechar()" class="btn-fechar">
      <mat-icon>close</mat-icon>
      Fechar
    </button>
  </mat-dialog-actions>
</div>
